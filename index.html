<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Learn English">
    <title>Learn English - Vocabolario Completo</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .container { min-height: 100vh; padding: 1.5rem; }
        .bg-gradient-1 { background: linear-gradient(135deg, #fbcfe8, #e9d5ff, #bfdbfe); }
        .bg-gradient-2 { background: linear-gradient(135deg, #f3e8ff, #fce7f3); }
        .bg-gradient-3 { background: linear-gradient(135deg, #dbeafe, #e9d5ff); }
        .bg-gradient-4 { background: linear-gradient(135deg, #d1fae5, #a7f3d0); }
        
        /* Gradients per categorie */
        .bg-red-yellow-pink { background: linear-gradient(90deg, #f87171, #fcd34d, #f472b6); }
        .bg-blue-purple { background: linear-gradient(90deg, #60a5fa, #a78bfa, #818cf8); }
        .bg-green-teal { background: linear-gradient(90deg, #4ade80, #2dd4bf, #22d3ee); }
        .bg-purple-pink { background: linear-gradient(90deg, #a78bfa, #f472b6, #fb7185); }
        .bg-yellow-orange { background: linear-gradient(90deg, #fcd34d, #fb923c, #ef4444); }
        .bg-indigo-blue { background: linear-gradient(90deg, #818cf8, #60a5fa, #22d3ee); }
        .bg-orange-red { background: linear-gradient(90deg, #fb923c, #f87171, #ef4444); }
        .bg-cyan-blue { background: linear-gradient(90deg, #22d3ee, #0ea5e9, #2563eb); }

        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; max-width: 42rem; margin: 0 auto; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; max-width: 42rem; margin: 0 auto; max-height: calc(100vh - 250px); overflow-y: auto; padding-bottom: 1rem; }
        
        .btn { border: none; cursor: pointer; transition: transform 0.2s; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.95); }
        .btn-category { color: white; padding: 1.5rem 1rem; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .btn-mode { width: 100%; color: white; font-size: 1.875rem; padding: 2rem 1.5rem; border-radius: 1.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); margin-bottom: 1.5rem; }
        .btn-learn { background: linear-gradient(90deg, #60a5fa, #22d3ee); }
        .btn-quiz { background: linear-gradient(90deg, #4ade80, #10b981); }
        .btn-item { background: white; padding: 1rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); min-height: 110px; gap: 0.5rem; }
        .btn-quiz-option { background: white; padding: 2rem; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); min-height: 180px; gap: 0.75rem; }
        .btn-back { background: white; padding: 0.75rem; border-radius: 9999px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); width: fit-content; margin-bottom: 1.5rem; }
        
        .text-center { text-align: center; }
        .emoji-large { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .emoji-xlarge { font-size: 4.5rem; }
        .emoji-huge { font-size: 4.5rem; }
        .title-main { font-size: 2.5rem; font-weight: bold; color: #7e22ce; margin-bottom: 1rem; animation: bounce 1s infinite; }
        .title-sub { font-size: 1.25rem; color: #9333ea; margin-bottom: 2rem; }
        .title-section { font-size: 2rem; font-weight: bold; color: #7e22ce; margin-bottom: 0.5rem; }
        
        .progress-bar { background: rgba(255, 255, 255, 0.3); border-radius: 9999px; height: 0.4rem; margin-top: 0.5rem; width: 100%; }
        .progress-fill { background: white; height: 0.4rem; border-radius: 9999px; transition: width 0.5s; }
        
        .stats-card { background: white; border-radius: 1.5rem; padding: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); max-width: 28rem; margin: 2rem auto 0; }
        .star-count { font-size: 2rem; font-weight: bold; color: #7e22ce; }
        .badge { background: linear-gradient(90deg, #fcd34d, #fb923c); color: white; font-weight: bold; font-size: 0.75rem; padding: 0.25rem 0.75rem; border-radius: 9999px; margin: 2px; }
        
        .btn-reset { background: #f1f5f9; color: #64748b; font-size: 0.8rem; padding: 0.4rem 0.8rem; border-radius: 9999px; margin-top: 1rem; border: 1px solid #e2e8f0; cursor: pointer; }
        .btn-reset:hover { background: #fee2e2; color: #ef4444; }

        @keyframes bounce { 0%, 100% { transform: translateY(-10%); } 50% { transform: translateY(0); } }
        .celebration { position: fixed; top: 20%; left: 50%; transform: translateX(-50%); z-index: 1000; animation: bounce 1s infinite; }
        .celebration-banner { background: #10b981; color: white; padding: 1rem 2rem; border-radius: 9999px; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            // -- PERSISTENZA DATI --
            const getInitialProgress = () => {
                const saved = localStorage.getItem('english_app_progress');
                return saved ? JSON.parse(saved) : { colors: 0, numbers: 0, animals: 0, shapes: 0, fruits: 0, body: 0, months: 0, gestures: 0 };
            };
            const getInitialStars = () => parseInt(localStorage.getItem('english_app_stars')) || 0;
            const getInitialBadges = () => JSON.parse(localStorage.getItem('english_app_badges')) || [];

            const [screen, setScreen] = useState('home');
            const [category, setCategory] = useState(null);
            const [stars, setStars] = useState(getInitialStars());
            const [badges, setBadges] = useState(getInitialBadges());
            const [progress, setProgress] = useState(getInitialProgress());
            const [quiz, setQuiz] = useState(null);
            const [result, setResult] = useState(null);
            const [celebration, setCelebration] = useState(null);

            useEffect(() => {
                localStorage.setItem('english_app_stars', stars);
                localStorage.setItem('english_app_badges', JSON.stringify(badges));
                localStorage.setItem('english_app_progress', JSON.stringify(progress));
            }, [stars, badges, progress]);

            const data = {
                colors: { name: 'Colors', emoji: 'üé®', bg: 'bg-red-yellow-pink', items: [
                    { name: 'Red', hex: '#EF4444', emoji: '‚ù§Ô∏è' }, { name: 'Blue', hex: '#3B82F6', emoji: 'üíô' },
                    { name: 'Yellow', hex: '#FCD34D', emoji: '‚≠ê' }, { name: 'Green', hex: '#10B981', emoji: 'üíö' },
                    { name: 'Purple', hex: '#A855F7', emoji: 'üíú' }, { name: 'Pink', hex: '#EC4899', emoji: 'ü©∑' }
                ]},
                animals: { name: 'Animals', emoji: 'üêæ', bg: 'bg-green-teal', items: [
                    {name:'Cat',emoji:'üê±'},{name:'Dog',emoji:'üê∂'},{name:'Lion',emoji:'ü¶Å'},{name:'Elephant',emoji:'üêò'},
                    {name:'Monkey',emoji:'üêµ'},{name:'Panda',emoji:'üêº'},{name:'Giraffe',emoji:'ü¶í'},{name:'Zebra',emoji:'ü¶ì'}
                ]},
                numbers: { name: 'Numbers', emoji: 'üî¢', bg: 'bg-blue-purple', items: [
                    {name:'One',emoji:'1Ô∏è‚É£'},{name:'Two',emoji:'2Ô∏è‚É£'},{name:'Three',emoji:'3Ô∏è‚É£'},{name:'Four',emoji:'4Ô∏è‚É£'},
                    {name:'Five',emoji:'5Ô∏è‚É£'},{name:'Six',emoji:'6Ô∏è‚É£'},{name:'Seven',emoji:'7Ô∏è‚É£'},{name:'Eight',emoji:'8Ô∏è‚É£'},
                    {name:'Nine',emoji:'9Ô∏è‚É£'},{name:'Ten',emoji:'üîü'}
                ]},
                fruits: { name: 'Fruits', emoji: 'üçé', bg: 'bg-yellow-orange', items: [
                    {name:'Apple',emoji:'üçé'},{name:'Banana',emoji:'üçå'},{name:'Orange',emoji:'üçä'},
                    {name:'Grapes',emoji:'üçá'},{name:'Strawberry',emoji:'üçì'},{name:'Watermelon',emoji:'üçâ'}
                ]},
                months: { name: 'Months', emoji: 'üìÖ', bg: 'bg-orange-red', items: [
                    {name:'January',emoji:'‚ùÑÔ∏è'},{name:'February',emoji:'‚ù§Ô∏è'},{name:'March',emoji:'üçÉ'},
                    {name:'April',emoji:'üåßÔ∏è'},{name:'May',emoji:'üå∏'},{name:'June',emoji:'‚òÄÔ∏è'},
                    {name:'July',emoji:'üèñÔ∏è'},{name:'August',emoji:'üç¶'},{name:'September',emoji:'üéí'},
                    {name:'October',emoji:'üéÉ'},{name:'November',emoji:'üçÇ'},{name:'December',emoji:'üéÑ'}
                ]},
                gestures: { name: 'Gestures', emoji: 'ü§ù', bg: 'bg-cyan-blue', items: [
                    {name:'Wave',emoji:'üëã'},{name:'Thumbs Up',emoji:'üëç'},{name:'Thumbs Down',emoji:'üëé'},
                    {name:'Clapping',emoji:'üëè'},{name:'Handshake',emoji:'ü§ù'},{name:'High Five',emoji:'üñêÔ∏è'}
                ]},
                shapes: { name: 'Shapes', emoji: '‚≠ê', bg: 'bg-purple-pink', items: [
                    {name:'Circle',emoji:'‚≠ï'},{name:'Square',emoji:'üü¶'},{name:'Triangle',emoji:'üî∫'},
                    {name:'Star',emoji:'‚≠ê'},{name:'Heart',emoji:'‚ù§Ô∏è'},{name:'Diamond',emoji:'üíé'}
                ]},
                body: { name: 'Body Parts', emoji: 'üëã', bg: 'bg-indigo-blue', items: [
                    {name:'Eyes',emoji:'üëÄ'},{name:'Nose',emoji:'üëÉ'},{name:'Mouth',emoji:'üëÑ'},
                    {name:'Ears',emoji:'üëÇ'},{name:'Hands',emoji:'üëã'},{name:'Feet',emoji:'ü¶∂'}
                ]}
            };

            const speak = (text) => {
                if (window.speechSynthesis) {
                    window.speechSynthesis.cancel();
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'en-US';
                    u.rate = 0.8;
                    window.speechSynthesis.speak(u);
                }
            };

            const addStars = (n, msg) => {
                const newStars = stars + n;
                setStars(newStars);
                if (msg) { setCelebration(msg); setTimeout(() => setCelebration(null), 1500); }
                
                let newBadges = [...badges];
                if (newStars >= 1 && !newBadges.includes('First Star')) newBadges.push('First Star');
                if (newStars >= 50 && !newBadges.includes('Super Learner')) newBadges.push('Super Learner');
                if (newStars >= 100 && !newBadges.includes('Champion')) newBadges.push('Champion');
                setBadges(newBadges);
            };

            const startQuiz = () => {
                const items = data[category].items;
                const correct = items[Math.floor(Math.random() * items.length)];
                const wrong = items.filter(i => i.name !== correct.name).sort(() => 0.5 - Math.random()).slice(0, 3);
                setQuiz({ correct, options: [correct, ...wrong].sort(() => 0.5 - Math.random()) });
                speak(`Find ${correct.name}`);
            };

            const checkAnswer = (item) => {
                if (item.name === quiz.correct.name) {
                    setResult('correct');
                    speak('Correct!');
                    addStars(2, 'Ottimo lavoro! ‚≠ê');
                    setProgress(p => ({ ...p, [category]: Math.min(p[category] + 10, 100) }));
                    setTimeout(() => { setResult(null); startQuiz(); }, 2000);
                } else {
                    setResult('wrong');
                    speak('Try again');
                    setTimeout(() => setResult(null), 1000);
                }
            };

            const resetGame = () => {
                if (confirm("Vuoi davvero cancellare tutti i progressi?")) {
                    localStorage.clear();
                    window.location.reload();
                }
            };

            // -- RENDER LOGIC --
            if (screen === 'home') {
                return (
                    <div className="container bg-gradient-1">
                        <div className="text-center">
                            <h1 className="title-main">‚ú® Learn English! ‚ú®</h1>
                            <p className="title-sub">Scegli una categoria!</p>
                        </div>
                        <div className="grid-2">
                            {Object.keys(data).map(k => (
                                <button key={k} className={`btn btn-category ${data[k].bg}`} onClick={() => { setCategory(k); setScreen('mode'); }}>
                                    <div className="emoji-large">{data[k].emoji}</div>
                                    <div style={{fontSize: '1rem'}}>{data[k].name}</div>
                                    <div className="progress-bar">
                                        <div className="progress-fill" style={{width: `${progress[k]}%`}}></div>
                                    </div>
                                </button>
                            ))}
                        </div>
                        <div className="stats-card text-center">
                            <div className="star-count">‚≠ê {stars} ‚≠ê</div>
                            <p style={{fontWeight:'bold', marginTop: '10px'}}>üèÜ Badge:</p>
                            <div style={{marginTop: '5px'}}>
                                {badges.map(b => <span key={b} className="badge">{b}</span>)}
                                {badges.length === 0 && <span style={{color: '#94a3b8', fontSize: '0.8rem'}}>Gioca per vincere badge!</span>}
                            </div>
                            <button className="btn-reset" onClick={resetGame}>Resetta Progressi üîÑ</button>
                        </div>
                    </div>
                );
            }

            if (screen === 'mode') {
                return (
                    <div className="container bg-gradient-2 text-center">
                        <button className="btn-back" onClick={() => setScreen('home')}>‚¨ÖÔ∏è Home</button>
                        <div className="flex-center">
                            <div className="emoji-xlarge">{data[category].emoji}</div>
                            <h2 className="title-section">{data[category].name}</h2>
                            <div className="mode-container" style={{marginTop: '2rem'}}>
                                <button className="btn btn-mode btn-learn" onClick={() => setScreen('learn')}>üìö Learn</button>
                                <button className="btn btn-mode btn-quiz" onClick={() => { setScreen('quiz'); startQuiz(); }}>üéÆ Quiz</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'learn') {
                return (
                    <div className="container bg-gradient-3">
                        <button className="btn-back" onClick={() => setScreen('mode')}>‚¨ÖÔ∏è Back</button>
                        <h2 className="title-section text-center">{data[category].name}</h2>
                        <p className="text-center">Tocca per ascoltare</p>
                        <div className="grid-3" style={{marginTop: '1.5rem'}}>
                            {data[category].items.map((item, i) => (
                                <button key={i} className="btn btn-item" onClick={() => { speak(item.name); addStars(1); }}>
                                    <span style={{fontSize: '2.5rem'}}>{item.emoji}</span>
                                    <span style={{fontSize: '0.9rem', color: '#7e22ce'}}>{item.name}</span>
                                    <span style={{fontSize: '0.7rem', color: '#3b82f6'}}>üîä</span>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }

            if (screen === 'quiz' && quiz) {
                return (
                    <div className="container bg-gradient-4">
                        <button className="btn-back" onClick={() => setScreen('mode')}>‚¨ÖÔ∏è Esci</button>
                        <div className="quiz-card text-center">
                            <p className="quiz-prompt">Trova:</p>
                            <h2 className="quiz-word">{quiz.correct.name}</h2>
                            <button className="btn-back" style={{margin:'10px auto'}} onClick={() => speak(quiz.correct.name)}>üîä Ascolta</button>
                        </div>
                        <div className="grid-2">
                            {quiz.options.map((item, i) => (
                                <button key={i} 
                                    className={`btn btn-quiz-option ${result === 'correct' && item.name === quiz.correct.name ? 'result-correct' : result === 'wrong' && item.name !== quiz.correct.name ? 'result-wrong' : ''}`}
                                    onClick={() => checkAnswer(item)}
                                    disabled={result !== null}>
                                    <span className="emoji-huge">{item.emoji}</span>
                                </button>
                            ))}
                        </div>
                        {celebration && <div className="celebration"><div className="celebration-banner">{celebration}</div></div>}
                    </div>
                );
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
