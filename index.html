<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Learn English">
    <title>Learn English - Bunny Adventure</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Fredoka', 'Comic Sans MS', sans-serif; 
            background-color: #e6f7ff; 
            -webkit-tap-highlight-color: transparent; 
            position: relative;
            color: #333;
        }

        /* Bunny Mascot Animation */
        .bunny-mascot {
            position: fixed;
            bottom: 40px;
            right: 20px;
            font-size: 3rem;
            animation: bounce 2s infinite;
            z-index: 50;
            pointer-events: none;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1));
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Letter Animation - Reduced motion option */
        .letter-anim {
            animation: pulse 2s infinite;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Rainbow animation only if not reduce-motion */
        @media (prefers-reduced-motion: no-preference) {
            .letter-anim.rainbow-enabled {
                animation: pulse 2s infinite, rainbow 3s infinite;
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        .container { min-height: 100vh; padding: 1rem; max-width: 600px; margin: 0 auto; }
        
        /* BANNER */
        .banner-img {
            width: 100%;
            border-radius: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 20px -5px rgba(0,150,255,0.3);
            display: block;
            border: 4px solid white;
        }
        
        /* Banner placeholder if image fails */
        .banner-placeholder {
            width: 100%;
            height: 150px;
            border-radius: 1.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 10px 20px -5px rgba(0,150,255,0.3);
            border: 4px solid white;
        }

        /* GRIGLIE */
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding-bottom: 1rem; }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }

        /* BOTTONI CATEGORIE */
        .btn { border: none; cursor: pointer; transition: transform 0.1s, box-shadow 0.2s; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; min-height: 44px; min-width: 44px; }
        .btn:active { transform: scale(0.95); }
        .btn:hover { box-shadow: 0 0 20px currentColor; }
        
        .btn-category { 
            color: white; 
            padding: 0.8rem 0.2rem; 
            border-radius: 1rem; 
            box-shadow: 0 5px 0 rgba(0,0,0,0.1); 
            height: 100px; 
            width: 100%;
            position: relative;
            border: 5px solid rgba(255, 255, 255, 0.9); 
        }
        .btn-category .emoji-large { font-size: 2.2rem; margin-bottom: 5px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2)); }
        .btn-category .category-name { font-size: 0.75rem; font-weight: 600; line-height: 1.1; }
        
        /* COLORI */
        .bg-numbers { background: #9575CD; }
        .bg-colors { background: #FF8A65; }
        .bg-fruits { background: #FFB74D; }
        .bg-animals { background: #F06292; }
        .bg-weather { background: #4FC3F7; }
        .bg-food { background: #81C784; }
        .bg-family { background: #FFD54F; color: #d35400; }
        .bg-months { background: #4DB6AC; }
        .bg-gestures { background: #7986CB; }
        .bg-shapes { background: #BA68C8; }
        .bg-body { background: #90A4AE; }
        .bg-clothes { background: #FFCCBC; }
        .bg-transports { background: #64B5F6; }
        .bg-alphabet { background: #A5D6A7; }
        
        /* UI ELEMENTI */
        .btn-back { 
            background: white; 
            padding: 15px 30px; 
            border-radius: 50px; 
            box-shadow: 0 6px 15px rgba(0,0,0,0.15); 
            margin-bottom: 20px; 
            color: #333; 
            font-weight: 800; 
            font-size: 1.4rem;
            border: 3px solid #e0e0e0; 
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .stats-card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-top: 20px; text-align: center; }
        .progress-bar { background: #f0f0f0; height: 10px; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        .progress-fill { background: #4FC3F7; height: 100%; transition: width 0.3s; }
        
        .mode-card { background: white; padding: 20px; border-radius: 20px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .btn-big { width: 100%; font-size: 1.5rem; padding: 20px; border-radius: 15px; margin-bottom: 15px; color: white; box-shadow: 0 6px 0 rgba(0,0,0,0.1); }
        .btn-learn { background: #4FC3F7; }
        .btn-quiz { background: #81C784; }
        .btn-reset { background: #FF8A65; font-size: 1rem; padding: 10px; }
        .btn-item { background: white; padding: 10px; border-radius: 15px; box-shadow: 0 4px 0 #eee; border: 1px solid #f0f0f0; color: #333; }
        
        .quiz-word { font-size: 3rem; color: #333; margin: 20px 0; }
        .celebration { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 5rem; animation: pop 0.5s; z-index: 100; pointer-events: none; }
        @keyframes pop { 0% { transform: translate(-50%,-50%) scale(0); } 80% { transform: translate(-50%,-50%) scale(1.2); } 100% { transform: translate(-50%,-50%) scale(1); } }
        
        .hint { color: #666; font-size: 1.1rem; margin: 10px 0; font-style: italic; }
        .error-shake { animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Audio status indicator */
        .audio-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 60;
        }

        /* Settings buttons */
        .settings-btn {
            margin: 5px;
            padding: 8px 15px;
            font-size: 0.85rem;
            border-radius: 20px;
            border: 2px solid #ddd;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .settings-btn.active {
            background: #4FC3F7;
            color: white;
            border-color: #4FC3F7;
        }

        /* Signature */
        .signature {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.75rem;
            color: #999;
            font-style: italic;
            z-index: 45;
            text-align: right;
        }

        /* High Contrast Mode */
        body.high-contrast { 
            background-color: #000 !important; 
            color: #fff !important; 
        }
        body.high-contrast .container { background-color: #000; }
        body.high-contrast h1, body.high-contrast h2, body.high-contrast h3, body.high-contrast p { color: #fff !important; }
        body.high-contrast .btn-item { background: #333 !important; color: #fff !important; border-color: #fff !important; }
        body.high-contrast .stats-card,
        body.high-contrast .mode-card { background: #333 !important; color: #fff !important; }
        body.high-contrast .btn-back { background: #555 !important; color: #fff !important; border-color: #777 !important; }
        body.high-contrast .btn-category { 
            border-color: rgba(255,255,255,0.9) !important; 
            color: #fff !important; 
        }
        body.high-contrast .btn-category .category-name { color: #fff !important; }
        body.high-contrast .progress-bar { background: #555 !important; }
        body.high-contrast .progress-fill { background: #00ffff !important; }
        body.high-contrast .quiz-word { color: #fff !important; }
        body.high-contrast .hint { color: #ccc !important; }
        body.high-contrast .btn-big { background: #555 !important; color: #fff !important; }
        body.high-contrast .btn-learn { background: #0066cc !important; }
        body.high-contrast .btn-quiz { background: #006600 !important; }
        body.high-contrast .btn-reset { background: #cc3300 !important; }
        body.high-contrast .bg-numbers { background: #4a148c !important; }
        body.high-contrast .bg-colors { background: #bf360c !important; }
        body.high-contrast .bg-fruits { background: #e65100 !important; }
        body.high-contrast .bg-animals { background: #880e4f !important; }
        body.high-contrast .bg-weather { background: #01579b !important; }
        body.high-contrast .bg-food { background: #1b5e20 !important; }
        body.high-contrast .bg-family { background: #ff8f00 !important; color: #fff !important; }
        body.high-contrast .bg-months { background: #004d40 !important; }
        body.high-contrast .bg-gestures { background: #1a237e !important; }
        body.high-contrast .bg-shapes { background: #4a148c !important; }
        body.high-contrast .bg-body { background: #263238 !important; }
        body.high-contrast .bg-clothes { background: #bf360c !important; }
        body.high-contrast .bg-transports { background: #01579b !important; }
        body.high-contrast .bg-alphabet { background: #1b5e20 !important; }
        body.high-contrast .banner-placeholder { filter: brightness(0.7); }
        body.high-contrast .letter-anim { filter: none !important; color: #fff !important; text-shadow: 2px 2px 4px rgba(255,255,255,0.5) !important; }
        body.high-contrast .audio-status { background: #333 !important; color: #fff !important; }
        body.high-contrast .settings-btn { background: #333 !important; color: #fff !important; border-color: #666 !important; }
        body.high-contrast .settings-btn.active { background: #0066cc !important; border-color: #0066cc !important; }
        body.high-contrast .signature { color: #999 !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [screen, setScreen] = useState('home');
            const [category, setCategory] = useState(null);
            const [level, setLevel] = useState(1);
            const [stars, setStars] = useState(0);
            const [progress, setProgress] = useState({});
            const [celebration, setCelebration] = useState(null);
            const [quiz, setQuiz] = useState(null);
            const [hint, setHint] = useState('');
            const [highContrast, setHighContrast] = useState(false);
            const [rainbowEnabled, setRainbowEnabled] = useState(true);
            const [dailyStreak, setDailyStreak] = useState(0);
            const [lastPlayed, setLastPlayed] = useState('');
            const [audioAvailable, setAudioAvailable] = useState(true);
            const [bannerError, setBannerError] = useState(false);
            const [attempts, setAttempts] = useState(0);
            
            const initRef = useRef(false);

            // Initialize from localStorage once
            useEffect(() => {
                if (!initRef.current) {
                    initRef.current = true;
                    const savedStars = parseInt(localStorage.getItem('stars')) || 0;
                    const savedProgress = JSON.parse(localStorage.getItem('progress') || '{}');
                    const savedStreak = parseInt(localStorage.getItem('dailyStreak')) || 0;
                    const savedLastPlayed = localStorage.getItem('lastPlayed') || '';
                    const savedHighContrast = localStorage.getItem('highContrast') === 'true';
                    const savedRainbow = localStorage.getItem('rainbowEnabled') !== 'false';
                    
                    setStars(savedStars);
                    setProgress(savedProgress);
                    setDailyStreak(savedStreak);
                    setLastPlayed(savedLastPlayed);
                    setHighContrast(savedHighContrast);
                    setRainbowEnabled(savedRainbow);
                    
                    // Check daily streak
                    const today = new Date().toDateString();
                    if (savedLastPlayed !== today) {
                        const newStreak = savedStreak + 1;
                        setDailyStreak(newStreak);
                        setLastPlayed(today);
                        localStorage.setItem('dailyStreak', newStreak);
                        localStorage.setItem('lastPlayed', today);
                    }
                    
                    // Check audio support
                    if (!window.speechSynthesis) {
                        setAudioAvailable(false);
                    }
                }
            }, []);

            // Save to localStorage when values change
            useEffect(() => {
                if (initRef.current) {
                    localStorage.setItem('stars', stars);
                }
            }, [stars]);

            useEffect(() => {
                if (initRef.current) {
                    localStorage.setItem('progress', JSON.stringify(progress));
                }
            }, [progress]);

            useEffect(() => {
                if (initRef.current) {
                    localStorage.setItem('highContrast', highContrast);
                    if (highContrast) {
                        document.body.classList.add('high-contrast');
                    } else {
                        document.body.classList.remove('high-contrast');
                    }
                }
            }, [highContrast]);

            useEffect(() => {
                if (initRef.current) {
                    localStorage.setItem('rainbowEnabled', rainbowEnabled);
                }
            }, [rainbowEnabled]);

            // DATI
            const data = {
                numbers: { 
                    name: 'Numbers', 
                    emoji: 'üî¢', 
                    bg: 'bg-numbers', 
                    levels: [
                        [{name:'One',emoji:'1Ô∏è‚É£'},{name:'Two',emoji:'2Ô∏è‚É£'},{name:'Three',emoji:'3Ô∏è‚É£'},{name:'Four',emoji:'4Ô∏è‚É£'},
                         {name:'Five',emoji:'5Ô∏è‚É£'},{name:'Six',emoji:'6Ô∏è‚É£'},{name:'Seven',emoji:'7Ô∏è‚É£'},{name:'Eight',emoji:'8Ô∏è‚É£'},
                         {name:'Nine',emoji:'9Ô∏è‚É£'},{name:'Ten',emoji:'üîü'}],
                        [{name:'Eleven',emoji:'11'},{name:'Twelve',emoji:'12'},{name:'Thirteen',emoji:'13'},{name:'Fourteen',emoji:'14'},
                         {name:'Fifteen',emoji:'15'},{name:'Sixteen',emoji:'16'},{name:'Seventeen',emoji:'17'},{name:'Eighteen',emoji:'18'},
                         {name:'Nineteen',emoji:'19'},{name:'Twenty',emoji:'20'}]
                    ]
                },
                colors: { name: 'Colors', emoji: 'üé®', bg: 'bg-colors', items: [
                    {name:'Red',emoji:'‚ù§Ô∏è'},{name:'Blue',emoji:'üíô'},{name:'Green',emoji:'üíö'},{name:'Yellow',emoji:'üíõ'},
                    {name:'Orange',emoji:'üß°'},{name:'Purple',emoji:'üíú'},{name:'Pink',emoji:'ü©∑'},{name:'Black',emoji:'üñ§'},
                    {name:'White',emoji:'ü§ç'},{name:'Brown',emoji:'ü§é'}
                ]},
                fruits: { name: 'Fruits', emoji: 'üçé', bg: 'bg-fruits', items: [
                    {name:'Apple',emoji:'üçé'},{name:'Banana',emoji:'üçå'},{name:'Grape',emoji:'üçá'},{name:'Orange',emoji:'üçä'},
                    {name:'Cherry',emoji:'üçí'},{name:'Strawberry',emoji:'üçì'},{name:'Watermelon',emoji:'üçâ'},{name:'Peach',emoji:'üçë'},
                    {name:'Pineapple',emoji:'üçç'},{name:'Pear',emoji:'üçê'},{name:'Lemon',emoji:'üçã'},{name:'Kiwi',emoji:'ü•ù'}
                ]},
                animals: { name: 'Animals', emoji: 'üê∂', bg: 'bg-animals', items: [
                    {name:'Cat',emoji:'üê±'},{name:'Dog',emoji:'üê∂'},{name:'Lion',emoji:'ü¶Å'},{name:'Elephant',emoji:'üêò'},
                    {name:'Monkey',emoji:'üêµ'},{name:'Tiger',emoji:'üêØ'},{name:'Bear',emoji:'üêª'},{name:'Rabbit',emoji:'üê∞'},
                    {name:'Fox',emoji:'ü¶ä'},{name:'Panda',emoji:'üêº'},{name:'Pig',emoji:'üê∑'},{name:'Cow',emoji:'üêÆ'}
                ]},
                months: { name: 'Months', emoji: 'üìÖ', bg: 'bg-months', items: [
                    {name:'January',emoji:'‚ùÑÔ∏è'},{name:'February',emoji:'üíò'},{name:'March',emoji:'üå±'},{name:'April',emoji:'üåßÔ∏è'},
                    {name:'May',emoji:'üå∏'},{name:'June',emoji:'‚òÄÔ∏è'},{name:'July',emoji:'üèñÔ∏è'},{name:'August',emoji:'üç¶'},
                    {name:'September',emoji:'üéí'},{name:'October',emoji:'üéÉ'},{name:'November',emoji:'üçÇ'},{name:'December',emoji:'üéÑ'}
                ]},
                weather: { name: 'Weather', emoji: 'üå§Ô∏è', bg: 'bg-weather', items: [
                    {name:'Sun',emoji:'‚òÄÔ∏è'},{name:'Rain',emoji:'üåßÔ∏è'},{name:'Cloud',emoji:'‚òÅÔ∏è'},{name:'Snow',emoji:'‚ùÑÔ∏è'},
                    {name:'Wind',emoji:'üí®'},{name:'Storm',emoji:'‚ö°'}
                ]},
                food: { name: 'Food', emoji: 'üçî', bg: 'bg-food', items: [
                    {name:'Apple',emoji:'üçé'},{name:'Pizza',emoji:'üçï'},{name:'Burger',emoji:'üçî'},{name:'Ice Cream',emoji:'üç¶'},
                    {name:'Cake',emoji:'üç∞'},{name:'Milk',emoji:'ü•õ'}
                ]},
                family: { name: 'Family', emoji: 'üë®‚Äçüë©‚Äçüëß', bg: 'bg-family', items: [
                    {name:'Mom',emoji:'üë©'},{name:'Dad',emoji:'üë®'},{name:'Sister',emoji:'üëß'},{name:'Brother',emoji:'üë¶'},
                    {name:'Grandma',emoji:'üëµ'},{name:'Grandpa',emoji:'üë¥'}
                ]},
                gestures: { name: 'Gestures', emoji: 'ü§ù', bg: 'bg-gestures', items: [
                    {name:'Hi',emoji:'üëã'},{name:'Yes',emoji:'üëç'},{name:'No',emoji:'üëé'},{name:'Clap',emoji:'üëè'},
                    {name:'Peace',emoji:'‚úåÔ∏è'},{name:'Love',emoji:'ü§ü'}
                ]},
                shapes: { name: 'Shapes', emoji: '‚≠ê', bg: 'bg-shapes', items: [
                    {name:'Circle',emoji:'‚≠ï'},{name:'Square',emoji:'üü¶'},{name:'Star',emoji:'‚≠ê'},{name:'Heart',emoji:'‚ù§Ô∏è'},
                    {name:'Triangle',emoji:'üî∫'},{name:'Diamond',emoji:'üíé'}
                ]},
                body: { name: 'Body', emoji: 'üëÄ', bg: 'bg-body', items: [
                    {name:'Eye',emoji:'üëÄ'},{name:'Ear',emoji:'üëÇ'},{name:'Hand',emoji:'üëã'},{name:'Nose',emoji:'üëÉ'},
                    {name:'Mouth',emoji:'üëÑ'},{name:'Foot',emoji:'ü¶∂'}
                ]},
                clothes: { name: 'Clothes', emoji: 'üëï', bg: 'bg-clothes', items: [
                    {name:'Shirt',emoji:'üëï'},{name:'Pants',emoji:'üëñ'},{name:'Dress',emoji:'üëó'},{name:'Hat',emoji:'üé©'},
                    {name:'Shoes',emoji:'üëü'},{name:'Socks',emoji:'üß¶'},{name:'Jacket',emoji:'üß•'},{name:'Scarf',emoji:'üß£'},
                    {name:'Tie',emoji:'üëî'},{name:'Shorts',emoji:'ü©≥'},{name:'Cap',emoji:'üß¢'},{name:'Gloves',emoji:'üß§'},
                    {name:'Blouse',emoji:'üëö'},{name:'Boots',emoji:'ü•æ'},{name:'Sandals',emoji:'ü©¥'},{name:'Sunglasses',emoji:'üï∂Ô∏è'}
                ]},
                transports: { name: 'Transports', emoji: 'üöó', bg: 'bg-transports', items: [
                    {name:'Car',emoji:'üöó'},{name:'Bus',emoji:'üöå'},{name:'Train',emoji:'üöÇ'},{name:'Airplane',emoji:'‚úàÔ∏è'},
                    {name:'Bicycle',emoji:'üö≤'},{name:'Boat',emoji:'‚õµ'},{name:'Motorcycle',emoji:'üèçÔ∏è'},{name:'Truck',emoji:'üöö'},
                    {name:'Helicopter',emoji:'üöÅ'},{name:'Scooter',emoji:'üõ¥'},{name:'Subway',emoji:'üöá'},{name:'Ship',emoji:'üö¢'}
                ]},
                alphabet: { name: 'Alphabet', emoji: 'üî§', bg: 'bg-alphabet', items: [
                    {name:'A',emoji:'A'},{name:'B',emoji:'B'},{name:'C',emoji:'C'},{name:'D',emoji:'D'},
                    {name:'E',emoji:'E'},{name:'F',emoji:'F'},{name:'G',emoji:'G'},{name:'H',emoji:'H'},
                    {name:'I',emoji:'I'},{name:'J',emoji:'J'},{name:'K',emoji:'K'},{name:'L',emoji:'L'},
                    {name:'M',emoji:'M'},{name:'N',emoji:'N'},{name:'O',emoji:'O'},{name:'P',emoji:'P'},
                    {name:'Q',emoji:'Q'},{name:'R',emoji:'R'},{name:'S',emoji:'S'},{name:'T',emoji:'T'},
                    {name:'U',emoji:'U'},{name:'V',emoji:'V'},{name:'W',emoji:'W'},{name:'X',emoji:'X'},
                    {name:'Y',emoji:'Y'},{name:'Z',emoji:'Z'}
                ]}
            };

            const getCurrentItems = () => {
                if (category === 'numbers') {
                    return data.numbers.levels[level - 1] || data.numbers.levels[0];
                }
                return data[category]?.items || [];
            };

            const updateProgress = (cat, completed) => {
                setProgress(p => ({ ...p, [cat]: { ...p[cat], completed: (p[cat]?.completed || 0) + completed } }));
            };

            const speak = (text) => {
                if (!audioAvailable) return;
                try {
                    window.speechSynthesis.cancel();
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'en-US'; 
                    u.rate = 0.9;
                    window.speechSynthesis.speak(u);
                } catch (e) {
                    console.error('Speech error:', e);
                    setAudioAvailable(false);
                }
            };

            const startQuiz = () => {
                const items = getCurrentItems();
                if (items.length === 0) return;
                const correct = items[Math.floor(Math.random() * items.length)];
                const wrong = items.filter(i => i.name !== correct.name).sort(() => 0.5 - Math.random()).slice(0, 3);
                setQuiz({ correct, options: [correct, ...wrong].sort(() => 0.5 - Math.random()) });
                setHint('');
                setAttempts(0);
                speak(`Find ${correct.name}`);
            };

            const getHintText = (correctName, attemptCount) => {
                if (attemptCount === 1) {
                    return `Hint: It starts with "${correctName.charAt(0)}"`;
                } else if (attemptCount === 2) {
                    const halfLength = Math.ceil(correctName.length / 2);
                    return `Hint: First half is "${correctName.substring(0, halfLength)}"`;
                } else {
                    return `Hint: The answer is "${correctName}"`;
                }
            };

            const checkAnswer = (item) => {
                if (item.name === quiz.correct.name) {
                    setStars(s => s + 2);
                    setCelebration('‚≠ê‚≠êüéâ');
                    speak('Good job!');
                    updateProgress(category, 1);
                    setTimeout(() => { setCelebration(null); startQuiz(); }, 1500);
                } else {
                    const newAttempts = attempts + 1;
                    setAttempts(newAttempts);
                    setHint(getHintText(quiz.correct.name, newAttempts));
                    const btn = document.querySelector(`[data-item="${item.name}"]`);
                    if (btn) btn.classList.add('error-shake');
                    setTimeout(() => btn?.classList.remove('error-shake'), 500);
                    
                    // Better audio feedback - say the correct answer after multiple attempts
                    if (newAttempts >= 2) {
                        speak(`The correct answer is ${quiz.correct.name}. Try again!`);
                    } else {
                        speak('Try again');
                    }
                }
            };

            const resetProgress = () => {
                if (window.confirm('Are you sure you want to reset all your progress? This cannot be undone!')) {
                    localStorage.clear();
                    setStars(0);
                    setProgress({});
                    setDailyStreak(0);
                    setLastPlayed('');
                    alert('Progress reset! üîÑ');
                }
            };

            const toggleHighContrast = () => setHighContrast(c => !c);
            const toggleRainbow = () => setRainbowEnabled(r => !r);

            if (screen === 'home') {
                return (
                    <div className="container">
                        {!audioAvailable && (
                            <div className="audio-status" style={{background: '#ffebee', color: '#c62828'}}>
                                üîá Audio unavailable
                            </div>
                        )}
                        
                        {!bannerError ? (
                            <img 
                                src="banner.PNG" 
                                className="banner-img" 
                                alt="Bunny Banner" 
                                loading="lazy"
                                onError={() => setBannerError(true)}
                            />
                        ) : (
                            <div className="banner-placeholder">
                                üê∞ Learn English üìö
                            </div>
                        )}
                        
                        <div className="grid-4">
                            {Object.keys(data).map(k => {
                                const catProgress = progress[k]?.completed || 0;
                                const total = data[k].levels ? data[k].levels.flat().length : data[k].items.length;
                                return (
                                    <button key={k} className={`btn btn-category ${data[k].bg}`} onClick={() => { setCategory(k); setLevel(1); setScreen('mode'); }}>
                                        <div className="emoji-large">{data[k].emoji}</div>
                                        <div className="category-name">{data[k].name}</div>
                                        {catProgress > 0 && <div className="progress-bar" style={{width: '100%', marginTop: '5px'}}><div className="progress-fill" style={{width: `${(catProgress / total) * 100}%`}}></div></div>}
                                    </button>
                                );
                            })}
                        </div>
                        <div className="stats-card">
                            <h3>My Stars: ‚≠ê {stars}</h3>
                            <p>Daily Streak: üî• {dailyStreak}</p>
                            <div style={{marginTop: '15px'}}>
                                <button 
                                    className={`settings-btn ${highContrast ? 'active' : ''}`}
                                    onClick={toggleHighContrast}
                                >
                                    {highContrast ? '‚úì' : ''} High Contrast
                                </button>
                                <button 
                                    className={`settings-btn ${rainbowEnabled ? 'active' : ''}`}
                                    onClick={toggleRainbow}
                                >
                                    {rainbowEnabled ? '‚úì' : ''} Rainbow Effect
                                </button>
                            </div>
                            <button className="btn btn-big btn-reset" style={{marginTop: '10px'}} onClick={resetProgress}>
                                üîÑ Reset Progress
                            </button>
                        </div>
                        <div className="bunny-mascot">üê∞</div>
                        <div className="signature">by Chloe</div>
                    </div>
                );
            }

            if (screen === 'mode') {
                const currentItems = getCurrentItems();
                return (
                    <div className="container" style={{textAlign:'center'}}>
                        <button className="btn-back" onClick={() => setScreen('home')}>‚¨ÖÔ∏è Back</button>
                        <h1 style={{fontSize:'3rem', marginBottom:'10px'}}>{data[category].emoji}</h1>
                        <h2 style={{marginBottom:'20px', color:'#333'}}>{data[category].name}</h2>
                        {category === 'numbers' && (
                            <div style={{marginBottom: '20px'}}>
                                <p>Level: {level} / 2</p>
                                <button className="btn-big" style={{background: '#9575CD', width: 'auto', padding: '10px 20px'}} onClick={() => setLevel(l => l < 2 ? l + 1 : 1)}>
                                    {level === 1 ? 'Next Level (11-20)' : 'Previous Level (1-10)'}
                                </button>
                            </div>
                        )}
                        
                        <div className="mode-card">
                            <button className="btn btn-big btn-learn" onClick={() => setScreen('learn')}>üìö Learn Words</button>
                            <button className="btn btn-big btn-quiz" onClick={() => { setScreen('quiz'); startQuiz(); }}>üéÆ Play Quiz</button>
                        </div>
                        <div className="progress-bar" style={{marginTop: '20px'}}>
                            <div style={{background: 'white', padding: '10px', borderRadius: '10px', boxShadow: '0 2px 10px rgba(0,0,0,0.1)'}}>
                                <p style={{textAlign: 'center', color: '#333', fontWeight: 'bold', margin: '0 0 10px 0'}}>Progress: {progress[category]?.completed || 0} / {currentItems.length}</p>
                                <div style={{background: '#f0f0f0', height: '10px', borderRadius: '5px', overflow: 'hidden'}}>
                                    <div className="progress-fill" style={{width: `${((progress[category]?.completed || 0) / currentItems.length) * 100}%`}}></div>
                                </div>
                            </div>
                        </div>
                        <div className="bunny-mascot">üê∞</div>
                        <div className="signature">by Chloe</div>
                    </div>
                );
            }

            if (screen === 'learn') {
                const currentItems = getCurrentItems();
                return (
                    <div className="container">
                        <button className="btn-back" onClick={() => setScreen('mode')}>‚¨ÖÔ∏è Back</button>
                        <h2 style={{textAlign:'center', marginBottom:'15px'}}>{data[category].name} {category === 'numbers' ? `(Level ${level})` : ''}</h2>
                        <div className="grid-3">
                            {currentItems.map((item, i) => {
                                const hue = (i * 360 / currentItems.length);
                                const isAlphabet = category === 'alphabet';
                                return (
                                    <button key={i} className="btn btn-item" onClick={() => speak(item.name)}>
                                        <div 
                                            className={isAlphabet ? `letter-anim ${rainbowEnabled ? 'rainbow-enabled' : ''}` : ''} 
                                            style={{
                                                fontSize: isAlphabet ? '4rem' : '2.5rem', 
                                                color: isAlphabet && !rainbowEnabled ? `hsl(${hue}, 100%, 50%)` : 'inherit'
                                            }}
                                        >
                                            {item.emoji}
                                        </div>
                                        <div style={{color:'#555', marginTop:'5px'}}>{item.name}</div>
                                    </button>
                                );
                            })}
                        </div>
                        <div className="bunny-mascot">üê∞</div>
                        <div className="signature">by Chloe</div>
                    </div>
                );
            }

            if (screen === 'quiz' && quiz) {
                return (
                    <div className="container" style={{textAlign:'center'}}>
                        <button className="btn-back" onClick={() => setScreen('mode')}>‚¨ÖÔ∏è Quit</button>
                        <div style={{margin:'20px 0'}}>
                            <p style={{color:'#666', fontSize:'1.2rem'}}>Find the:</p>
                            <h1 className="quiz-word">{quiz.correct.name}</h1>
                            <button onClick={() => speak(quiz.correct.name)} style={{background:'none', border:'none', fontSize:'1.2rem', color:'#0066cc', cursor: 'pointer'}}>
                                üîä {audioAvailable ? 'Listen' : 'Audio Off'}
                            </button>
                            {hint && <p className="hint">{hint}</p>}
                        </div>

                        <div className="grid-2">
                            {quiz.options.map((item, i) => {
                                const hue = (i * 360 / quiz.options.length);
                                const isAlphabet = category === 'alphabet';
                                return (
                                    <button key={i} className="btn btn-item" style={{height:'120px'}} data-item={item.name} onClick={() => checkAnswer(item)}>
                                        <div 
                                            className={isAlphabet ? `letter-anim ${rainbowEnabled ? 'rainbow-enabled' : ''}` : ''} 
                                            style={{
                                                fontSize: isAlphabet ? '5rem' : '3.5rem', 
                                                color: isAlphabet && !rainbowEnabled ? `hsl(${hue}, 100%, 50%)` : 'inherit'
                                            }}
                                        >
                                            {item.emoji}
                                        </div>
                                    </button>
                                );
                            })}
                        </div>
                        {celebration && <div className="celebration">{celebration}</div>}
                        <div className="bunny-mascot">üê∞</div>
                        <div className="signature">by Chloe</div>
                    </div>
                );
            }

            return <div className="container"><h1>Loading...</h1></div>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
